<!--
SPDX-FileCopyrightText: Copyright (C) 2020 Opal Health Informatics Group at the Research Institute of the McGill University Health Centre <john.kildea@mcgill.ca>

SPDX-License-Identifier: AGPL-3.0-or-later
-->

<div class="modal-header">
    <h3 class="modal-title">{{patient.LastName}}, {{patient.FirstName}} ({{patient.Mrn +"-"+ patient.Site}})<div style="float:right">Age:{{patient.Age}} Sex:{{patient.Sex}}</div></h3>
</div>

<div class="modal-body" ng-init="addScrollFunc()">

    <br/>
    <!--Purpose Buttons-->
    <div ng-if="purposeSelected === ''">
        <div class="row" style="display: block">
            <h2 style="text-align:center;margin-top:0">Questionnaire List</h2>
            <br/>
            <div style="left:17%; right:17%" class="col-xs-4 col-md-4 ques-row text-center animate-show" ng-repeat="purpose in purposeList" ng-click="updatePurpose(purpose)">
                <input style="font-size:20px;padding:20px" type="button" class="btn btn-info btn-block btn-que" value="{{purpose.title}} Questionnaires">
                <span style="padding-top: 5%;width: 5%;right: 0%;" class = "alert-circle" ng-class="alertDotForPurpose(purpose) ? 'red-circle' : ''"></span>
            </div>
        </div>
    </div>
    <!--Study Buttons-->
    <div ng-if="purposeSelected.title === 'Research' && studySelected === ''">
        <div class="row questionnaire-container">
            <h2 style="text-align:center;margin-top:0;">Research Questionnaires</h2>
            <br/>
            <div class="col-xs-4 col-md-4 ques-row text-center animate-show" ng-repeat="study in studyList" ng-click="updateStudy(study)">
                <input style="font-size:20px;padding:20px" type="button" class="btn btn-info btn-block btn-que" value="{{study.title}} Questionnaires">
                <span style="padding-top: 5%;width: 5%;right: 0%;" class = "alert-circle" ng-class="alertDotForStudy(study) ? 'red-circle' : ''"></span>
            </div>
        </div>
    </div>
    <!--Questionnaire Section-->
    <div ng-if="(purposeSelected !== ''&& purposeSelected.title !== 'Research') || studySelected !== ''">
    <div style="display: flex;justify-content: space-between;width: 100%">
        <div style="width: 10%;">
            <input type="button" ng-show="patient.confidMode === 'Nominal Mode'" class="btn btn-block"  style="background-color: grey; width: 60%" value="{{patient.QStatus === 'red-circle' ? 'Mark as reviewed' : 'Reviewed'}}" >
            <input type="button" ng-show="patient.confidMode !== 'Nominal Mode'" class="btn" ng-class="patient.QStatus === 'red-circle' ? 'btn-default' : 'btn-success'" ng-style="(patient.QStatus === 'red-circle') ? {'background-color': '#fe4b4b'} : {}" value="{{patient.QStatus === 'red-circle' ? 'Mark as reviewed' : 'Reviewed'}}" ng-click="markAsReviewed()">

        </div>
        <div style="width: 50%">
            <h2 ng-if="purposeSelected.title !== 'Research'" style="text-align:center">{{purposeSelected.title}} Questionnaire List</h2>
            <h2 ng-if="purposeSelected.title === 'Research'" style="text-align:center">{{studySelected.title}} Questionnaire List</h2>
        </div>
        <div>
            Last review: {{patient.LastQuestionnaireReview}}
        </div>
    </div>
    <br>

    <div class="row questionnaire-container">
        <div style="display: flex;justify-content: space-between;width: 100%">
            <div style="width: 70%;left: 1%;position: relative">
                <h3 style="text-align: center;margin-top: 0;width: fit-content">Patient Responded Questionnaires</h3>
            </div>
            <div style="right: 1%; position:relative">
                Search for Questionnaire:
                <input type="search" ng-model="qfilter" ng-change="changeIndexGroup()" placeholder="Filter questionnaires..."/>
            </div>
        </div>
        <div class="col-xs-4 col-md-4 ques-row text-center animate-show" ng-repeat="que in ques = (questionnaireList | filter: listFilter(qfilter) )" ng-click="displayChart(que)">
            <div ng-if="que.respondentTitle === 'Patient' && que.purposeId === purposeSelected.purposeId && checkStudy(que)">
                <input type="button" class="btn btn-info btn-block btn-que" ng-class="{'selected-button': que === selectedQuestionnaire}" value="{{que.name}}">
                <span style="padding-top: 5%;width: 5%;right: 0%;" class="alert-circle {{que.reviewed}}"></span>
            </div>
        </div>
    </div>
    <br>
    <div class="row questionnaire-container">
        <div style="display: flex;justify-content: space-between;width: 100%">
            <div style="left: 1%; position:relative">
                <h3 style="text-align: center;margin-top: 0;width: fit-content">Clinician Responded Questionnaires</h3>
            </div>
        </div>
        <div class="col-xs-4 col-md-4 ques-row text-center animate-show" ng-repeat="clinician in clinicianQuestionnaire = (clinicianQuestionnaireList | filter: clinicalListFilter(qfilter) )" ng-click="displayClinicalQuestionnaire(clinician)">
            <div ng-if="clinician.purpose === purposeSelected.purposeId && checkStudy(clinician)">
                <input  type="button" class="btn btn-info btn-block btn-que" ng-class="{'selected-button': clinician === selectedQuestionnaire}" value="{{clinician.name}}">
                <span style="padding-top: 5%;width: 5%;right: 0%;" ng-class="{'alert-circle red-circle' : !clinician.completed}"></span>
            </div>
        </div>
    </div>

    <div ng-if="selectedQuestionnaire.visualization === 1">
        <hr>
        <h2 style="text-align: center">{{selectedQuestionnaire.Name}}</h2>
        <h3>Last Answered On: {{selectedQuestionnaire.lastDateAnswered}}</h3>

        <br>

        <div class="row">
            <div class="col-xs-4 col-md-4" ng-repeat="questions in selectedQuestionnaire.questions track by $index">
                <div id='question{{$index}}'></div>
            </div>
        </div>
    </div>

    <div ng-if="selectedQuestionnaire.visualization === 0">
        <hr>
        <h2 style="text-align: center">{{selectedQuestionnaire.Name}}</h2>
        <h3>Last Answered On: {{selectedQuestionnaire.lastDateAnswered}}</h3>

        <br>

        <center>
        <table border=0 width='90%'>
        <tr>
            <td width='5%'></td>
            <td width='15%'>Date Answered</td>
            <td width='50%'>Question</td>
            <td width='30%'>Answer</td>
        </tr>
        </table>
        </center>

        <div ng-repeat="questions in selectedQuestionnaire.questions track by $index">
            <hr ng-if="questions.DisplayDate">
            <center>
            <table border=0 width='90%'>
            <tr>
                <td width='5%'></td>
                <td width='15%'>{{questions.DisplayDate}}</td>
                <td width='50%'></td>
                <td width='30%'></td>
            </tr>
            <tr class='td12'>
                <td></td>
                <td></td>
                <td><b>{{questions.Description}}</b><br />{{questions.Choice}}</td>
                <td>{{questions.Answer}}</td>
            </tr>
            <tr>
                <td colspan='10'>&nbsp;</td>
            </tr>

            </table>
            </center>
        </div>

    </div>

    <br>
</div>
<div class="modal-footer" ng-if="purposeSelected !== ''">
    <button class="btn btn-primary" style="float:left" ng-click="back()">Back</button>
</div>
