<!--
SPDX-FileCopyrightText: Copyright (C) 2019 Opal Health Informatics Group at the Research Institute of the McGill University Health Centre <john.kildea@mcgill.ca>

SPDX-License-Identifier: AGPL-3.0-or-later
-->

<!DOCTYPE html>
<html>
<head>
    <title>Waiting Room Management System - Register Patient for SMS</title>
    <base href="/orms/">
</head>

<body ng-app="myApp" ng-controller="main">
    <center>
        <table border=0 class="table" style="width: 100%">
            <tr>
                <td align="center" valign="center"></td>
                <td width="15%"><img ng-src="{{rmsLogo}}" width="100%"></td>
                <td align="center" valign="center">
                    <center>
                        <h2 align="center" style="margin-left:10%; margin-right:15%; color: rgb(111,84,153); font-size: 32px"><b>Register Patient for SMS</b><br></h2>
                    </center>
                </td>
                <td width="15%"><a href="VirtualWaitingRoom/aboutOpal.html"><h2 style="color: rgb(111,84,153); font-size: 40px"><b><u>About Opal</u></b></h2></td>
                <td align="center" valign="bottom"></td>
            </tr>
        </table>
    </center>


    <table border="0" width="50%" padding="5">
        <tr><td valign="top"> Register or unregister a patient to receieve an SMS message when his/her name appears on the TV screens. Patient must already exist in the ORMS</font>
        </td></tr>
    </table>
    <p>

    <form action="php/api/private/v1/patient/updatePhoneNumber" method="post">
    <input type="hidden" name="specialityGroupId" value="{{specialityGroupId}}">
    <input type="hidden" name="patientId" value="{{patientId}}">
    <table border="0" width="50%" padding="2">

    <tr bgcolor=#1D0886 fgcolor=#FFFFFF><th colspan=5 width="20%" align="left"><font color=#FFFFFF>Register Patient</font></th></tr>
    <tr><td><b>MRN</b></td><td colspan="3"> <input
        maxlength="40" size="20"
        placeholder="1234567"
        pattern="[0-9]{7}"
        ng-model="mrn"
        required
        disabled
        ></td></tr>
    <tr><td><b>Site</b></td><td colspan="3"><input maxlength="40" size="20" name="site" ng-model="site" required disabled></td></tr>
    <tr><td><b>Mobile number</b></td><td colspan="3"> <input type="tel"
        maxlength="40" size="20" name="phoneNumber"
        placeholder="1234567890"
        pattern="[0-9]{10}"
        required
        > 10 digits, no spaces</td></tr>
    <tr><td></td></tr>
    <tr><td><b>Language Preference</b></td>
    <td>
        <select name="languagePreference">
           <option value="French" selected>French</option>
           <option value="English">English</option>
        </select>
    </td>
    </tr>
    <tr><td colspan=2><hr></td></tr>

    <tr>
    <td colspan=5 align="center">
    <input type="submit" value="Submit"><input type="reset">
    </td>
    </tr>
    </table>
    </form>

    <br>

    <form action="php/api/private/v1/patient/unregisterPhoneNumber" method="post">
    <table border="0" width="50%" padding="2">

    <tr bgcolor=#1D0886 fgcolor=#FFFFFF><th colspan=5 width="20%" align="left"><font color=#FFFFFF>Unregister Mobile Number</font></th></tr>
    <tr><td><b>Mobile number</b></td><td colspan="3"> <input type="tel"
        maxlength="40" size="20" name="phoneNumber"
        placeholder="1234567890"
        pattern="[0-9]{10}"
        required
        > 10 digits, no spaces</td></tr>
    <tr><td colspan=2><hr></td></tr>

    <tr>
    <td colspan=5 align="center">
    <input type="submit" value="Submit"><input type="reset">
    </td>
    </tr>
    </table>
    </form>

    <hr>
    <center> Problems and bug reports to <a href="mailto: {{supportEmail}}">{{supportEmail}}</a></center>
    <center> <a href="./">Main Page</a></center>
</body>

<script src="node_modules/angular/angular.min.js"></script>
<script src="node_modules/angular-cookies/angular-cookies.min.js"></script>
<script src="VirtualWaitingRoom/js/config.js"></script>

<script>
var app = angular.module('myApp', ['ngCookies', 'vwr.config']);

app.config(['$locationProvider', function ($locationProvider)
{
    $locationProvider.html5Mode({
        enabled: true,
        requireBase: false,
        rewriteLinks : false
    });
}]);

app.controller('main', function($scope, $location, $cookies, CONFIG)
{
    var pageParams = $location.search();

    $scope.rmsLogo = CONFIG.BRANDING_RMS_LOGO_PATH;
    $scope.supportEmail = CONFIG.BRANDING_SUPPORT_EMAIL_ADDRESS;

    $scope.mrn = pageParams.mrn;
    $scope.site = pageParams.site;
    $scope.patientId = pageParams.patientId;

    $scope.specialityGroupId = $cookies.get("specialityGroupId");

});

</script>

</html>
