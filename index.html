<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <base href="/orms/">
    <title>Opal RMS</title>
    <style>
        ul li {padding-bottom: 25px;}
    </style>
    <script src="node_modules/angular/angular.min.js"></script>
    <script src="node_modules/angular-cookies/angular-cookies.min.js"></script>

</head>
<body ng-app="myApp" ng-controller="main" style="color: rgb(0, 0, 0); background-color: rgb(128,128, 128); font-size:18px; font-family: Helvetica,Arial,sans-serif;" link="#0000ee" vlink="#551a8b" alink="#ee0000">
<center>

<table style="table-layout:fixed;text-align: left; width: 1300px; background-color: rgb(255,254,244); font-size:24px;border-spacing: 10px 0px;">
<thead></thead>
<tbody>
    <tr style="font-family: Helvetica,Arial,sans-serif;">
    <td colspan="10" style="vertical-align: center; background-color: rgb(255,254,244);">
        <center><img src="images/Opal_RMS_logo.png" alt="MUHC logo" border="0" width="40%"></center></td>
    </tr>

    <tr style="font-family: Helvetica,Arial,sans-serif;">
        <td colspan="10" style="vertical-align: center; background-color: rgb(111,84,153);">
            <span style="font-weight: bold; color: rgb(255,255,255); font-size:40px;"><center>Opal Room Management System</center></span>
        </td>
    </tr>

    <tr style="font-family: Helvetica,Arial,sans-serif;">
    <td></td>
    <td colspan='8' style="vertical-align: center; background-color: rgb(255,254,244);text-align: right;">
        <span style="color: rgb(0,0,0);font-size:20px;"><a href="#" ng-click="logOut()">Log Out</a></span><br></td>
    <td></td>
    </tr>

    <tr>
    <td><br></td>
    </tr>

    <tr>
        <td></td>
        <td style="vertical-align: center;" colspan="8">
            <span style="font-weight: bold; color: rgb(0,0,0); font-size:25px;">
                <center>
                    <ul style="list-style:none;">
                        <li><a href="./VirtualWaitingRoom/mainPageClinics.html">Opal Virtual Waiting Room - Clinics</a></li>
                        <li><a href="./VirtualWaitingRoom/screenDisplay.html?location={{hub}}">Opal Virtual Waiting Room - TV Screen</a></li>
                        <li><a href="./VirtualWaitingRoom/clinicalViewer.html">Opal Clinical Viewer</a></li>
                        <!-- <li><a href="./VirtualWaitingRoom/index.html">Virtual Waiting Room - Profile Manager</a></li> -->
                        <li><a href="./interface/AddOn.html">Register Patient for Opal SMS Messages<br></a></li>
                        <li><a href="./kiosk/?location={{hubName+ ' Reception'}}&site={{site}}">Opal Patient check-in interface <br></a></li>
                        <li><a href="./reports/indexOnc.html">Opal RMS Waiting Room Reports</a></li>
                    </ul>
                </center>
            </span>
        </td>
    </tr>

    <tr><td><br></td></tr>

<tr><td><br></td></tr>

</tbody>
</table>

</center>

</body>
</html>

<script>
var app = angular.module('myApp',['ngCookies']);

app.controller('main', function($scope,$http,$cookies,$location,$window)
{
    $scope.speciality = $cookies.get("specialityGroupName");
    $scope.hub        = $cookies.get("clinicHubId");
    $scope.hubName    = $cookies.get("clinicHubName");
    $scope.site       = $cookies.get("hospitalCode");

    $scope.logOut = function()
    {
        $http({
            url: "php/api/public/v1/auth/removeSession",
            method: "POST",
            data: null
        })
        .then(x => {})
        .catch(err => {
            $error = err?.data?.error ? err.data.error : "CSRF token or Session Id is missing.";
            console.log($error);
        });     

        // need to set the path specifically to ensure removal: https://stackoverflow.com/a/25373087
        $cookies.remove("ormsAuth", {path: "/"});
        $cookies.remove("specialityGroupId", {path: "/"});
        $cookies.remove("specialityGroupName", {path: "/"});
        $cookies.remove("clinicHubId", {path: "/"});
        $cookies.remove("clinicHubName", {path: "/"});
        $cookies.remove("hospitalCode", {path: "/"});
        $window.location.reload();
    }
});

</script>
