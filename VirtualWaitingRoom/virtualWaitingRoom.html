<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<title>Virtual Waiting Room</title>
<base href="/orms/">

<!-- angular app will be bootstapped inside the scripts -->

<!--Angular libraries -->
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/angular/angular.min.js"></script>
<script src="node_modules/checklist-model/checklist-model.js"></script>
<script src="node_modules/ui-bootstrap4/dist/ui-bootstrap-tpls.js"></script>
<script src="node_modules/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js"></script>
<script src="node_modules/ui-select/dist/select.min.js"></script>
<script src="node_modules/angular-animate/angular-animate.min.js"></script>
<script src="node_modules/angular-aria/angular-aria.min.js"></script>
<script src="node_modules/angular-cookies/angular-cookies.min.js"></script>
<script src="node_modules/angular-material/angular-material.js"></script>
<script src="node_modules/ng-table/bundles/ng-table.min.js"></script>

<!--Firebase libraries -->
<script src="node_modules/firebase/lib/firebase-web.js"></script>
<script src="node_modules/angularfire/dist/angularfire.min.js"></script>

<!--Highcharts -->
<script src="node_modules/highcharts/highcharts.js"></script>
<script src="node_modules/highcharts/modules/exporting.js"></script>
<script src="node_modules/highcharts/modules/offline-exporting.js"></script>
<script src="node_modules/highcharts-ng/dist/highcharts-ng.min.js"></script>

<!--Crytojs -->
<script type="text/javascript" src="node_modules/crypto-js/crypto-js.js"></script>

<!--CSS -->
<!-- <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css"> -->
<!-- use bootstrap v3 css; the css styling can be done later -->
<link rel="stylesheet" href="./css/bootstrap_3.3.6.min.css">
<link rel="stylesheet" href="node_modules/ui-select/dist/select.min.css">
<link rel="stylesheet" href="node_modules/angular-material/angular-material.min.css">
<link rel="stylesheet" href="node_modules/ng-table/bundles/ng-table.min.css">
<link rel="stylesheet" href="./css/vwrStyle.css">

<!--Custom controllers -->
<script src="js/vwr/module.js"></script>
<script src="js/vwr/controllers/virtualWaitingRoom.js"></script>
<script src="js/vwr/bootstrapper.js"></script>
<script src="js/vwr/controllers/callModal.js"></script>
<script src="js/vwr/controllers/authDialog.js"></script>
<script src="js/vwr//controllers/diagnosisModal.js"></script>
<script src="js/vwr/controllers/formModal.js"></script>
<script src="js/vwr/controllers/selectorModal.js"></script>
<script src="js/vwr/controllers/questionnaireModal.js"></script>
<script src="js/vwr/controllers/registerSMSModal.js"></script>
<script src="js/vwr/controllers/weightModal.js"></script>

</head>

<body>
    <div id="mockId"></div>

    <div ng-controller="virtualWaitingRoomController" ng-cloak>
        <center>
            <table border=0 class="table" style="width: 100%">
                <tr>
                    <td align="center" valign="center"></td>
                    <td align="center" valign="center">
                        <center>
                            <h2><b>{{pageSettings.ProfileId}} - Virtual Waiting Room</b><br> </h2>
                        </center>
                    </td>
                    <td align="center" valign="bottom"></td>
                </tr>
            </table>
        </center>

        <div style="width:100%;display:inline-flex">
            <div style="width:80%;">
                <div class="option-holder-div">
                    <md-button class="md-primary selector-button" ng-click="openSelectorModal(allResources,selectedResources,'Resource/Clinician Filter')" ng-disabled="!resourceLoadingEnabled"><b>User Selected Resource(s):</b></md-button>
                    <div class="option-holder">
                        <span ng-repeat="res in selectedResources"><mark>{{res.Name}}</mark> </span>
                    </div>
                </div>

                <br>

                <div class="option-holder-div">
                    <md-button class="md-primary selector-button" ng-click="openSelectorModal(allLocations,selectedLocations,'Location(s) Selection')" ng-disabled="!resourceLoadingEnabled"><b>User Selected Location(s):</b></md-button>
                    <div class="option-holder">
                        <span ng-repeat="loc in selectedLocations"><mark>{{loc.Name}}</mark> </span>
                    </div>
                </div>

                <br>

                <!-- <div class="option-holder-div" style="align-items: center;">
                    <md-button class="md-primary" ng-disabled="!resourceLoadingEnabled" ng-click="focusOnId('zoom-input')"><b>MSSS Zoom Link:</b></md-button>
                    <input id="zoom-input" class="zoom-input" ng-model="pageSettings.zoomLink" placeholder="Please paste your Zoom Personal Meeting ID URL here (include the pwd=XXXXXXX part of the URL)">
                </div> -->

            </div>

            <div>
                <div style="position:absolute;right:0;width:20%;">
                    <md-button class="md-primary" disabled><b>Clinical Area: {{pageSettings.ClinicalArea}}</b></md-button>
                    <br>
                    <md-button class="md-primary" ng-if="patientLoadingEnabled && resourceLoadingEnabled" ng-click="openLegendDialog()"><b>Show Legend</b></md-button>
                    <br>
                    <span>
                        <img class="selector-gif" ng-if="!patientLoadingEnabled || !resourceLoadingEnabled" src="images/waiting.gif"></img>
                        <span ng-if="patientLoadingEnabled && resourceLoadingEnabled" class="btn-group">
                            <label ng-model="pageSettings.SelectedRowTypes.CheckedIn" class="btn btn-primary" ng-class="pageSettings.SelectedRowTypes.CheckedIn ? '' : 'btn-row-type'" uib-btn-checkbox>Checked In</label>
                            <label ng-model="pageSettings.SelectedRowTypes.NotCheckedIn" class="btn btn-primary" ng-class="pageSettings.SelectedRowTypes.NotCheckedIn ? '' : 'btn-row-type'" uib-btn-checkbox>Scheduled</label>
                            <label ng-model="pageSettings.SelectedRowTypes.Completed" class="btn btn-primary" ng-class="pageSettings.SelectedRowTypes.Completed ? '' : 'btn-row-type'" uib-btn-checkbox>Completed</label>
                        </span>
                    </span>
                </div>
            </div>
        </div>

        <br><br><br>

        <table class="table patient-list">
            <tr class="bg-info">
                <th ng-click="changeSortOrder()">&#9660;</th>
                <th ng-repeat="column in pageSettings.ColumnsDisplayed" style="text-align: center;">
                    {{column.DisplayName}}<br /><span class="glyphicon {{column.Glyphicon}}"></span>
                </th>
            </tr>
            <tr ng-repeat="patient in checkins | multiResourceFilter: [selectedResources,pageSettings] | orderBy: pageSettings.sortOrder | orderBy: sortByRowType" ng-class="determineRowClass(patient)">
                <td></td>
                <td ng-repeat="column in pageSettings.ColumnsDisplayed" ng-switch="column.ColumnName" style="text-align: center;">
                    <span ng-switch-when="AppointmentCode">{{patient.AppointmentName}}<br>[{{patient.CheckinSystem}}]</span>

                    <span ng-switch-when="ArrivalTime" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            {{patient.ArrivalDateTime_hh}}:{{'0'+patient.ArrivalDateTime_mm | limitTo:-2}}
                        </span>
                    </span>

                    <span ng-switch-when="AssignRoom" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            <button ng-show="screenRows.patients.hasOwnProperty(patient.AppointmentId)" ng-click="openCallModal(patient,'ASSIGN EXAM ROOM')" ng-class="checkIfPatientInExamRoom(patient) ? 'btn btn-success green-button' : 'btn btn-danger'">{{checkIfPatientInExamRoom(patient) ? patient.VenueId : 'Assign Exam Room'}}</button>
                        </span>
                    </span>

                    <span ng-switch-when="CallPatient" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            <button ng-show="!screenRows.patients.hasOwnProperty(patient.AppointmentId)" ng-click="openCallModal(patient)" class="btn btn-primary">Call Patient</button>
                            <button ng-show="screenRows.patients[patient.AppointmentId].PatientStatus == 'Called'" ng-click="callPatientAgain(patient,true)" class="btn btn-danger">Call Again</button>
                        </span>
                        <span ng-switch-when="NotCheckedIn">
                            <span ng-show="patient.PhoneNumber && pageSettings.zoomLink && isZoomAppointment(patient.AppointmentName)">
                                <button ng-show="!screenRows['zoomLinkSent'].hasOwnProperty(patient.AppointmentId)" class="btn btn-zoom" ng-click="sendZoomLink(patient)">Send Zoom</button>
                                <button ng-show="screenRows['zoomLinkSent'].hasOwnProperty(patient.AppointmentId)" ng-click="sendZoomLink(patient)" class="btn btn-zoom">Resend Zoom</button>
                            </span>
                        </span>
                    </span>

                    <span ng-switch-when="CellPhoneNumber" ng-switch="patient.RowType">
                        <button ng-if="patient.PhoneNumber" ng-click="openSMSRegistrationModal(patient)" class="btn btn-info turquoise-button">{{patient.PhoneNumber}}</button>
                        <button ng-if="!patient.PhoneNumber" ng-click="openSMSRegistrationModal(patient)" class="btn btn-info turquoise-button" ng-style="isZoomAppointment(patient.AppointmentName) ? {'border':'4px dashed red'} : {}">Register For SMS</button>
                    </span>

                    <span ng-switch-when="ClinicName">{{patient.ResourceName}}</span>

                    <span ng-switch-when="CurrentLocation" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            {{patient.VenueId}}<br>
                        </span>
                        <div style="display:inline-flex;height:34px;">
                            <span ng-if="patient.PhoneNumber" style="font-size:20px;top:25%;" class="glyphicon glyphicon-phone"></span>
                            <img ng-if="patient.OpalPatient === 1" style="height:25px;top:18%;position:relative" ng-src="{{opalLogo}}"></img>
                        </div>
                    </span>

                    <span ng-switch-when="CompleteAppointment" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            <button ng-show="screenRows.patients[patient.AppointmentId].PatientStatus === 'Called' || patient.VenueId === 'BACK TO WAITING ROOM' || patient.VenueId === 'TEST CENTRE WAITING ROOM'" ng-click="openFormModal(patient)" class="btn btn-success green-button">Complete</button>
                            <span ng-show="screenRows.patients[patient.AppointmentId].PatientStatus == 'CheckedOut'"><b>Checked out!</b></span>
                        </span>
                        <span ng-switch-when="NotCheckedIn">
                            <button ng-show="isZoomAppointment(patient.AppointmentName)" ng-click="openFormModal(patient)" class="btn btn-success green-button">Complete</button>
                            <span ng-show="screenRows.patients[patient.AppointmentId].PatientStatus == 'CheckedOut'"><b>Checked out!</b></span>
                        </span>
                    </span>

                    <div ng-switch-when="Diagnosis" class="diagnosis-hover">
                        <button ng-click="openDiagnosisModal(patient)" class="btn btn-info btn-diagnosis" ng-mouseover="loadPatientDiagnosis(patient)">Add</button>
                        <span class="diagnosis-table">
                            <table style="width: 100%;margin: 5px">
                                <tr>
                                    <th>Code</th>
                                    <th>Description</th>
                                    <th>Date</th>
                                </tr>
                                <tr ng-repeat="diag in lastPatientDiagnosisList">
                                    <td>{{diag.diagnosis.subcode}}</td>
                                    <td>{{diag.diagnosis.subcodeDescription}}</td>
                                    <td>{{diag.diagnosisDate | date: 'yyyy-MM-dd'}}</td>
                                </tr>
                            </table>
                        </span>
                    </div>

                    <span ng-switch-when="PatientName">
                        {{patient.LastName}}, {{patient.FirstName}}<br>
                        <span>({{patient.Mrn +"-"+ patient.Site}})</span>
                    </span>

                    <button ng-switch-when="Questionnaires" ng-click="openQuestionnaireModal(patient)" class="btn btn-info btn-questionnaire">View<span class="alert-circle {{patient.QStatus}}"></span></button>

                    <span ng-switch-when="RemainingTime" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            {{patient.TimeRemaining}}
                        </span>
                    </span>

                    <span ng-switch-when="ScheduledStartTime">{{patient.ScheduledStartTime_hh}}:{{"0"+patient.ScheduledStartTime_mm | limitTo:-2}}</span>

                    <span ng-switch-when="UndoCall" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            <button ng-show="screenRows.patients[patient.AppointmentId].PatientStatus == 'Called'" ng-click="sendToLocation(patient,pageSettings.WaitingRoom,true)" class="btn btn-info">Undo Call</button>
                        </span>
                        <span ng-switch-when="NotCheckedIn">
                            <button ng-show="patient.PhoneNumber && pageSettings.zoomLink && wasZoomLinkSent(patient) && isZoomAppointment(patient.AppointmentName)" class="btn btn-zoom" ng-click="openZoomLink()">Open Zoom</button>
                        </span>
                    </span>

                    <span ng-switch-when="SendForWeight" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn" ng-switch="patientWeightRequired(patient)">
                            <button ng-switch-when="Yes" ng-click="openWeightModal(patient)" class="btn btn-warning" style="background-color:#4e5cf0;border-color:#4436ee;">Enter Weight</button>
                            <button ng-switch-when="Already Taken" ng-click="openWeightModal(patient)" class="btn btn-warning" ng-class="patient.WeightDate === 'Today' ? 'green-button' : 'weight-indicator'">H: {{patient.Height}} cm, W: {{patient.Weight}} kg<br>BSA: {{patient.BSA}} m<sup>2</sup></button>
                            <button ng-switch-when="No" ng-click="addToWeighArray(patient)" class="btn btn-warning" style="background-color:#4e5cf0;border-color:#4436ee;">Send For Weight</button>
                        </span>
                    </span>

                    <span ng-switch-when="WaitingTime" ng-switch="patient.RowType">
                        <span ng-switch-when="CheckedIn">
                            {{patient.WaitTime}}
                        </span>
                    </span>

                    <span ng-switch-when="WeighPatient" ng-switch="patient.RowType">
                        <span ng-switch="patientWeightRequired(patient)">
                            <button ng-switch-when="Yes" ng-click="openWeightModal(patient)" class="btn btn-warning" style="background-color:#4e5cf0;border-color:#4436ee;">Enter Weight</button>
                            <button ng-switch-when="Already Taken" ng-click="openWeightModal(patient)" class="btn btn-warning" ng-class="patient.WeightDate === 'Today' ? 'green-button' : 'weight-indicator'">H: {{patient.Height}} cm, W: {{patient.Weight}} kg<br>BSA: {{patient.BSA}} m<sup>2</sup></button>
                        </span>
                    </span>

                    <span ng-switch-when="WearablesData">
                        <div ng-if="patient.wearablesURL"><a href="{{patient.wearablesURL}}" class="glyphicon glyphicon-heart" style="color: #ff6251; font-size: 30px;"></a></div>
                    </span>
                </td>
            </tr>
        </table>

        <nav class="navbar-xs navbar-inverse navbar-fixed-bottom bottom-bar">
            <span style="margin-left: 10px; float: left;">
                <i class="glyphicon glyphicon-time"></i>
                Current Time: <b>{{timeNow | date:'yyyy-MM-dd hh:mm'}}</b>
            </span>
            <span>
                Questions or Comments? Please contact opal@muhc.mcgill.ca
            </span>
            <span style="margin-right: 10px; float: right;" ng-class="screenMessage == 'Normal' ? '' : 'status-danger'">
                <b>Status:</b> {{screenMessage}}
            </span>
        </nav>

    </div>
</body>
</html>
